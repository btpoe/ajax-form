/**
 * AjaxForm - v0.2.0
 *
 * @author  UNION <union.co>
 * @copyright 2014 Union, LLC
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 */
!function($){function e(e,a){function r(){o=$.extend(o,a),o.namespace=s.wrap.data(o.namespaceSetter)||o.namespace,s.subButton=s.wrap.find("button"),s.errors=[]}function t(){s.set=function(e,a){$.isPlainObject(e)?$.extend(o,e):o.hasOwnProperty(e)&&(o[e]=a)},s.dump=function(){console.log(o)},s.reset=function(){s.wrap.get(0).reset()}}function n(){function e(e){var a=e?o.submitActiveHTML:o.submitInactiveHTML;s.subButton.html(a).prop("disabled",!e)}var a={removeError:function(){this.errorMessage.remove(),this.errorMessage=void 0,$(this).removeClass(o.errorClass),s.errorCount--,0==s.errorCount&&e(!0)},submit:function(r){return r.preventDefault(),e(!1),$.ajax({type:"POST",url:s.wrap.attr("action"),data:s.wrap.serialize(),dataType:"json"}).done(function(a){e(!0),o.successCallback(s,a)}).fail(function(r){if(s.errorCount=0,r.responseJSON){s.subButton.html(o.submitActiveHTML);var t=r.responseJSON.errors;$.each(t,function(e,r){var t=o.namespace?o.namespace+"["+e+"]":e,n=$('[name="'+t+'"]');if(n.length){n.addClass(o.errorClass).one("keyup.error",a.removeError);var i=$('<small class="'+o.errorClass+'"></small>').html(r[0]),u=n.parents("label");u.length||(u=n.parent()),s.errorCount++,u.append(i),n.get(0).errorMessage=i}})}0==s.errorCount&&e(!0),o.failCallback(s,r)}),!1}};s.wrap.on("submit.ajaxForm",a.submit)}var s=this;s.wrap=$(e);var o={errorClass:"error",namespace:!1,namespaceSetter:"namespace",submitActiveHTML:"Submit",submitInactiveHTML:'<i class="ajax-waiting"></i>',successCallback:function(e,a){var r=e.wrap.parents(".reveal-modal"),t=$('<p class="message message-success"></p>').html(a.message);e.wrap.replaceWith(t),r.length&&(setTimeout(function(){r.foundation("reveal","close")},2e3),setTimeout(function(){e.reset(),t.replaceWith(e.wrap)},3500))},failCallback:function(e,a){}};s.init=function(){return s.wrap[0].ajaxForm?s.wrap[0].ajaxForm:(r(),t(),n(),s.wrap[0].ajaxForm=s,s.wrap[0].ajaxForm)}}$.fn.ajaxForm=function(a){return this.each(function(){var r=$.extend({},a,$(this).data("ajaxForm"));return new e(this,r).init()})}}(jQuery||Zepto);